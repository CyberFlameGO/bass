; import Concourse library
(import (load (.concourse))
        resource
        run-task)

; define a Concourse resource
(def booklit
  (resource linux :git {:uri "https://github.com/vito/booklit"}))

; find latest version
(def latest-version
  (last (booklit .check)))

; fetch the repo
(def latest-booklit
  (booklit .get latest-version))

; run tests
(run-task latest-booklit/ci/test.yml
          :inputs {:booklit latest-booklit})

; build and extract output to local ./assets/ directory
(let [outputs (run-task latest-booklit/ci/build.yml
                        :inputs {:booklit latest-booklit})]
  (emit (:assets outputs) *stdout*))
