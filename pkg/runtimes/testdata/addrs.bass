(defn http-server [index]
  (from (linux/alpine)
    ($ apk add python3)
    (-> ($ python3 -m http.server)
        (with-mount (mkfile ./index.html index) ./index.html)
        (with-port :http 8000))))

(let [srv (http-server "hello, world!")]
  (-> ($ wget -O- (addr srv :http "http://$host:$port"))
      (with-image (linux/alpine))
      (read :raw)
      next
      dump))
