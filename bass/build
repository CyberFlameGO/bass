#!/usr/bin/env bass

(defn main []
  (for [{:src src
         (:version "dev") version
         (:os "linux") os
         (:arch "amd64") arch} *stdin*]
    (use (src/project))
    (logf "building and smoke-testing %s" src)
    (let [dist (project:build src version os arch)]
      (project:smoke-test dist)
      (emit dist *stdout*))))
